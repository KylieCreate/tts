<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>TTS Browser Source</title>
<style>
body { font-family: sans-serif; background:#111; color:#0f0; padding:10px; }
#status { font-weight:bold; margin-bottom:10px; }
#messages { max-height:400px; overflow-y:auto; }
.message { margin:2px 0; }
</style>
</head>
<body>
<div id="status">Page loaded âœ…</div>
<div id="messages"></div>

<script>
const API="/api/messages";
const messagesDiv = document.getElementById("messages");

function addMessage(msg){
  const el = document.createElement("div");
  el.className="message";
  el.textContent = msg;
  messagesDiv.appendChild(el);
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

// Poll messages every 200ms
async function pollMessages(){
  try{
    const res = await fetch(API);
    const data = await res.json();
    if(data.messages?.length){
      data.messages.forEach(msg=>{
        console.log("[Browser] Received:", msg);
        addMessage(msg);
        speechSynthesis.speak(new SpeechSynthesisUtterance(msg));
      });
    }
  } catch(e){
    console.error("[Browser] Poll error:", e);
  }
  setTimeout(pollMessages,200);
}

pollMessages();
</script>
</body>
</html>
